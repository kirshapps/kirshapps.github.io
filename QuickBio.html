<html>
<head>
<script>
      window.fbAsyncInit = function() {
        FB.init({
          appId      : '812506892178397',
          xfbml      : true,
          version    : 'v2.3'
        });
      };

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "http://connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'facebook-jssdk'));
</script>
<script src="http://code.jquery.com/jquery-2.1.4.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.js"></script>
<script src="format.js"></script>

<script>
    
var fbData = [];
var selectedFormat = [];
    
var bioFormats = [
    {
    tag:["first_name"],
    text:"Hello, my name is {first_name}"     
    },
    {
    tag:["first_name","last_name"],
    text:"Hello, my name is {first_name} {last_name}"    
    },
    {
    tag:["first_name","last_name", "email"],
    text:"Hello, my name is {first_name} {last_name}. You can email me at {email}"
    },
    {
    tag:["first_name","last_name", "quotes"],
    text:"{quote}. This is a quote that inspires {first_name} {last_name}."
    },
    {
    tag:["first_name","last_name", "email","quotes"],
    text:"{quote}. This is a quote that inspires {first_name} {last_name}. You can email him at {email}"
    },
    {
    tag:["first_name","last_name", "email", "sports"],
    text:"Hello, my name {first_name} {last_name}. You can email me at {email}. I enjoy sports like {sport1} and {sport2}."
    },
    {
    tag:["first_name","last_name", "quotes", "sports"],
    text:"Hello, my name {first_name} {last_name}. You can email me at {email}. I enjoy sports like {sport1} and {sport2}.My favourite quote is {quote}"
    },
    {
    tag:["first_name","last_name", "quotes", "sports", "favorite_athletes"],
    text:"Hello, my name {first_name} {last_name}. You can email me at {email}. I enjoy sports like {sport1} and {sport2}. My favorite athletes are {ath1} and {ath2}. My favourite quote is {quote}."
    },
    {
    tag:["first_name","last_name", "quotes", "favorite_athletes"],
    text:"Hello, my name {first_name} {last_name}. You can email me at {email}. My favorite athletes are {ath1} and {ath2}. My favourite quote is {quote}."
    },
    {},
    {}
];
    

function findTextForTags(tags) {
   for (var y = 0; y < bioFormats.length; y++) {
        if ($(tags).not(bioFormats[y].tag).length === 0 && $(bioFormats[y].tag).not(tags).length === 0) {
            selectedFormat = bioFormats[y];
            break;
        }
   }
    
   if (selectedFormat != nil) {
       formatText(selectedFormat);
   }
   else {
       toastr.warning("Try a different combination");
   }
}
    
function formatText(formatInfo) {
    var finalString = format(formatInfo.text, fbData);
    console.log(finalString);
}


    
var startDate = 1432955433871;
    
var selectionCount = 1;

var now = 0;
now = Date.now();
    
var nowInDays = 0;
var minutes = 0;
var hours = 0;

nowInDays = (now - startDate) / (1000*60*60*24);
minutes = ((now - startDate) / (1000*60));
hours = ((now - startDate) / (1000*60*60));
    
if (nowInDays > 1) {
    document.title = "QuickBio - Since " + nowInDays.toFixed(0) + " days ago";
}
else if (hours < 1) {
    document.title = "QuickBio - Since " + minutes.toFixed(0) + " minutes ago";
}
else {
    document.title = "QuickBio - Since " + hours.toFixed(0) + " hours ago";
}

function login() {
FB.getLoginStatus(function(response) {
  if (response.status === 'connected') {
     step2();
  }
  else {
     FB.login(function(response) {
     if (checkLoginStatus()) {
         step2();
     }
    else {
        toastr.error("Your login failed, please try again.", "Login Failed");
    }
    }, {scope:'public_profile,email,user_about_me,user_relationships,user_relationship_details,user_likes,user_birthday,user_work_history'});
  }
});
}

function checkLoginStatus() {
    FB.getLoginStatus(function(response) {
        if (response === 'connected') {
            return true;
        }
        else {
            return false;
        }
    });
}
    
function startup() {
    var selectBox = document.getElementsByTagName('select');
    var select = selectBox[0];
    select.style.display = 'none';
    document.getElementById('openingtext').style.display = 'none';
    document.getElementById('endingtext').style.display = 'none';
    document.getElementById('add-data-button').style.display = 'none';
    document.getElementById('done-button').style.display = 'none';

    if (checkLoginStatus()) {
        step2();
    }
    else {
        login();
    }
}
    
function step2() {
    console.log("Logged In");
    document.getElementById('login-button').style.display = 'none';
    var select = document.getElementById('select-box-1');
    select.style.display = 'inline-block';
    document.getElementById('openingtext').style.display = 'inline-block';
    document.getElementById('endingtext').style.display = 'inline-block';
    document.getElementById('add-data-button').style.display = 'inline-block';
    document.getElementById('done-button').style.display = 'block';
    console.log(select);
    FB.api("/me?fields=sports,relationship_status,gender,inspirational_people,interested_in,favorite_athletes,favorite_teams,quotes,first_name,last_name", function (response) {
       fbData = response;
       document.getElementById('step1').innerHTML = 'Welcome, ' + response.first_name;
       populateSelect(select, response);
    }
          
    );
}



           
function populateSelect(select, data) {
     if (data && !data.error) {
        var dataKeys = Object.keys(data);
        for (var x = 0; x < dataKeys.length; x++) {
            select.options[x] = new Option(dataKeys[x], dataKeys[x], false, false);
        }
     }
}
    
function addSelect() {
    var optionDiv = document.getElementById('fb-data-options');
    var oldSection = document.getElementById('data-option-1');
    selectionCount = selectionCount + 1;
    var newSection = oldSection.cloneNode(true);
    newSection.id = 'data-option-' + selectionCount;
    var selects = newSection.getElementsByTagName('select');
    var select = selects[0];
    select.id = 'select-box-' + selectionCount;
    var doneButton = document.getElementById('done-button');
    optionDiv.insertBefore(newSection, doneButton);
}

function collectOptions() {
    var optionDiv = document.getElementById('fb-data-options');
    var selects = optionDiv.getElementsByTagName('select');
    
    var selectedItems = [];
    
    for (var x = 0; x < selects.length; x++) {
        var select = selects[x];
        var selected = select.options[select.selectedIndex].value;
        selectedItems[x] = selected;
    }
    
    var existCount;
    
    for (var x = 0; x < selectedItems.length; x++) {
        if (fbData[selectedItems[x]] != null) {
            existCount++;
        }
    }
    
    
    findTextForTags(selectedItems);
}

</script>
<link href='http://fonts.googleapis.com/css?family=Bree+Serif' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.6.0/pure-min.css">
<link rel="stylesheet" href="font-awesome.css">
<style>
#header1 {
  text-align: center;
  font-family: 'Bree Serif', serif;
  font-size: 75px;
  color: rgb(39,39,38);
}
#step1 {
  text-align: center;
  font-family: 'Bree Serif', serif;
  font-size: 50px;
  color: rgb(39,39,38);
}
body {
  background-color: rgb(237,239,235);
}
.line-separator{
height:1px;
background:rgb(255,205,82);
border-bottom:1px solid rgb(249,80,82);
}
.button {
    background-color: rgb(249,80,82);
    border-radius: 4px;
    width: 160px;
    color: rgb(237,239,235);
    height: 80px;
    font-family: 'Bree Serif', serif;
    font-size:30px;
}
    
.button2 {
    background-color: rgb(249,80,82);
    border-radius: 4px;
    width: 120px;
    color: rgb(237,239,235);
    height: 60px;
    font-family: 'Bree Serif', serif;
    font-size:30px;
}

select {
    padding:3px;
    margin: 0;
    -webkit-border-radius:4px;
    -moz-border-radius:4px;
    border-radius:4px;
    -webkit-box-shadow: 0 3px 0 #ccc, 0 -1px #fff inset;
    -moz-box-shadow: 0 3px 0 #ccc, 0 -1px #fff inset;
    box-shadow: 0 3px 0 #ccc, 0 -1px #fff inset;
    background: #f8f8f8;
    color:#888;
    border:none;
    outline:none;
    display: inline-block;
    -webkit-appearance:none;
    -moz-appearance:none;
    appearance:none;
    cursor:pointer;
    margin-left: 4px;
}
#openingtext {
  font-family: 'Bree Serif', serif;
  font-size: 20px;
  color: rgb(39,39,38); 
}
#endingtext {
  font-family: 'Bree Serif', serif;
  font-size: 20px;
  color: rgb(39,39,38); 
}
#add-data-button {
   background-color: transparent;
   font-family: 'Bree Serif', serif;
   border: none;
   font-size: 20px;
   cursor:pointer;
   overflow: hidden;
   outline:none; 
}

/* Targetting Webkit browsers only. FF will show the dropdown arrow with so much padding. */
@media screen and (-webkit-min-device-pixel-ratio:0) {
    select {padding-right:18px}
}
</style>
<title>Making your biography's simple since a long time ago</title>  
</head>
<body onload="startup()">
<h1 id="header1">QuickBio</h1>
<div class="line-separator"></div>
<h2 id="step1">Step 1:</h2>
<center><button id="login-button" class="button pure-button" onclick="login()">Login</button>
<div id="fb-data-options">
<section id="data-option-1">
<p id='openingtext'>Use </p>
<select id="select-box-1">
</select>
<p id="endingtext"> in my bio,</p>
<button onclick="addSelect()" id="add-data-button" class=""><i class="fa fa-plus"></i></button>
</section>
<button id="done-button" class="button pure-button" onclick="collectOptions()">Done</button>
</div>
</center>
</body>
</html>